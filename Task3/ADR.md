### <a name="_b7urdng99y53"></a>**Название задачи:** Концептуальная архитектура системы открытия депозитов для MVP

### <a name="_hjk0fkfyohdk"></a>**Автор:** Ершов Павел

### <a name="_uanumrh8zrui"></a>**Дата:** 17.05.2024

### <a name="_3bfxc9a45514"></a>**Функциональные требования**

Опишите здесь верхнеуровневые Use Cases. Их нужно оформить в виде таблицы с пошаговым описанием:

| **№** | **Действующие лица или системы** | **Use Case**                   | **Описание**                                                                                       |
|:-----:|:---------------------------------|:-------------------------------|:---------------------------------------------------------------------------------------------------|
|   1   | Клиент (сайт)                    | Просмотр списка депозитов      | Клиент видит доступные депозиты с актуальными ставками на сайте с защитой трафика (TLS).           |
|   2   | Клиент (сайт)                    | Подача заявки на депозит       | Клиент оставляет номер телефона и ФИО, заявка передаётся в кол-центр.                              |
|   3   | Менеджер кол-центра	             | Обработка заявки	              | Менеджер просматривает заявку, может предложить особые условия.                                    |
|   4   | Клиент                           | Идентификация в отделении      | Клиент приходит в отделение банка для личной проверки документов.                                  |
|   5   | Клиент (интернет-банк)           | Просмотр депозитов	            | Клиент видит список депозитов и персонализированные ставки с защитой данных.                       |
|   6   | Клиент (интернет-банк)           | Подача заявки с подтверждением | Клиент указывает счёт и сумму, подтверждает операцию через СМС-код.                                |
|   7   | Система интернет-банка           | Отправка СМС-кода              | Ядро системы отправляет СМС-код для подтверждения операции                                         |
|   8   | Менеджер бэк-офиса депозитов     | Подтверждение условий в АБС    | Менеджер в бэк-офисе подтверждает условия и открывает депозит в АБС.                               |
|   9   | Система АБС                      | Создание депозитного счёта     | АБС создаёт депозитный счёт на основе данных от микросервиса открытия депозитов (deposit-service). |
|  10   | Клиент                           | Получение СМС-уведомлений      | Клиент получает уведомления о подтверждении ставки и открытии депозита.                            |

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**

Опишите здесь нефункциональные требования и архитектурно-значимые требования.

| **№** | **Требование**                                                                                             |
|:-----:|:-----------------------------------------------------------------------------------------------------------|
|   1   | Высокая доступность — 99,9% uptime сервисов, с поддержкой DR и резервного ЦОД.                             |
|   2   | Безопасность — обязательное шифрование трафика (TLS) между клиентом, интернет-банком, кол-центром и АБС.   |
|   3   | Производительность — время отклика операций в интернет-банке в пределах миллисекунд.                       |
|   4   | Масштабируемость — горизонтальное масштабирование микросервисов интернет-банка и кол-центра.               |
|   5   | Минимизация нагрузки на АБС — изоляция АБС через микросервис открытия депозитов и очередь сообщений Kafka. |
|   6   | Использование технологий с внутренней экспертизой: MS SQL, Oracle, Kafka, TLS, REST API.                   |
|   7   | Поддержка отказоустойчивости и резервирования для всех критичных сервисов.                                 |
|   8   | Удобство и единый стиль интерфейсов с применением дизайн-системы банка.                                    |

### <a name="_qmphm5d6rvi3"></a>**Решение**

На мой взгляд лучшее решение это постепенно отказываться от использования АБС в пользу микросервисов, которые
будут постепенно выносить всю логику по работе с кредитами, депозитами, созданием клиента отдельно от АБС.
На АБС ляжет только валидация скажем так, то есть депозит сервис сам определит ставки, сроки, а в АБС мы будем только
авторизовать открытие депозита для клиента. 

За счет асинхронного взаимодействия мы получаем возможность к горизонтальному масштабированию, во время пиковых нагрузок
динамически добавлять инстансы микросервисов. 

Kafka также даёт гарантию доставки сообщения и в целом это делает довольно быстро как нам и нужно.

### <a name="_bjrr7veeh80c"></a>**Альтернативы**

Можно использовать вместо Kafka MQ и очереди для обработки сообщений между АБС и микросервисами.
Альтернативы микросервисам в данном случае я не вижу, потому что с АБС надо снять нагрузку и мы не хотим лезть в ядро.
Только минимальные доработки.

**Недостатки, ограничения, риски**

Основная проблема: начало работы с kafka брокером т.к. у специалистов нет опыта работы с kafka.
Необходимо проектировать микросервисы с учетом асинхронного взаимодействия (транзакции, правила отката в случае ошибки)


